{% extends "en/layout.html" %}

{% block content %}
  <h2>Model Details for {{ model_id }}</h2>

  <h3 class="section-header">Actual vs Prediction Chart</h3>
    {% if plot_html %}
      {{ plot_html | safe }}
    {% else %}
      <p>Not enough data to generate the chart.</p>
    {% endif %}
    
  <section class="cards-grid">

    <div class="card">
      <h3>Metrics</h3>
      {% for tipo, valores in details.metrics.items() %}
        <div class="metric-block">
          <h4 class="subtle">{{ tipo|capitalize }}</h4>
          <div class="kv-list">
            {% for k, v in valores.items() %}
              <div class="kv-row">
                <span class="k">
                  {% set key = k|lower %}
                  {% if key in ['mse','rmse','mae','mape','r2','n'] %}{{ key|upper }}{% else %}{{ k|capitalize }}{% endif %}
                </span>
                <span class="v">
                  {% if key == 'n' %}
                    {{ '%.0f'|format(v) }}
                  {% elif key in ['mape'] %}
                    {{ '%.4f'|format(v) }}%
                  {% else %}
                    {{ '%.4f'|format(v) }}
                  {% endif %}
                </span>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="card">
      <h3>Hyperparameters</h3>
      <div class="accordion">
        {% for key, value in details.hyperparameters.items() %}
          <details class="acc-item"{% if loop.first %} open{% endif %}>
            <summary class="acc-summary">{{ key|capitalize }}</summary>
            <div class="acc-panel">
              {% if value is string or value is number %}
                <div class="kv-row"><span class="k">Value</span><span class="v">{{ value }}</span></div>
              {% else %}
                <pre class="code-small">{{ value|tojson(indent=2) }}</pre>
              {% endif %}
            </div>
          </details>
        {% endfor %}
      </div>
    </div>
  </section>
{% endblock %}

{% block helptext %}
  <h4>Model Details</h4>
  <p>
    Here you can find the details of the selected model: the prediction chart, performance metrics, and the hyperparameters used.
  </p>
  <p>
    For more information about what each item is, I recommend looking for the corresponding sections in the TFG report (which you have below).
  </p>
{% endblock %}
