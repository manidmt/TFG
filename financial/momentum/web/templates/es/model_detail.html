{% extends "es/layout.html" %}

{% block content %}
  <h2>Detalles del modelo {{ model_id }}</h2>

  <h3 class="section-header">Gráfico Real vs Predicción</h3>
    {% if plot_html %}
      {{ plot_html | safe }}
    {% else %}
      <p>No hay datos suficientes para generar la gráfica.</p>
    {% endif %}
    
  <section class="cards-grid">

    <div class="card">
      <h3>Métricas</h3>
      {% for tipo, valores in details.metrics.items() %}
        <div class="metric-block">
          <h4 class="subtle">{{ tipo|capitalize }}</h4>
          <div class="kv-list">
            {% for k, v in valores.items() %}
              <div class="kv-row">
                <span class="k">
                  {% set key = k|lower %}
                  {% if key in ['mse','rmse','mae','mape','r2','n'] %}{{ key|upper }}{% else %}{{ k|capitalize }}{% endif %}
                </span>
                <span class="v">
                  {% if key == 'n' %}
                    {{ '%.0f'|format(v) }}
                  {% elif key in ['mape'] %}
                    {{ '%.4f'|format(v) }}%
                  {% else %}
                    {{ '%.4f'|format(v) }}
                  {% endif %}
                </span>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="card">
      <h3>Hiperparámetros</h3>
      <div class="accordion">
        {% for key, value in details.hyperparameters.items() %}
          <details class="acc-item"{% if loop.first %} open{% endif %}>
            <summary class="acc-summary">{{ key|capitalize }}</summary>
            <div class="acc-panel">
              {% if value is string or value is number %}
                <div class="kv-row"><span class="k">Valor</span><span class="v">{{ value }}</span></div>
              {% else %}
                <pre class="code-small">{{ value|tojson(indent=2) }}</pre>
              {% endif %}
            </div>
          </details>
        {% endfor %}
      </div>
    </div>
  </section>
{% endblock %}

{% block helptext %}
  <h4>Detalles del modelo</h4>
  <p>
    Aquí se muestran los detalles del modelo seleccionado: la gráfica de predicción, las métricas de rendimiento y los hiperparámetros utilizados.
  </p>
  <p>
    Para más información sobre qué es cada cosa, recomiendo buscar las secciones correspondientes en la memoria del TFG (la tienes ahí abajo).
  </p>
{% endblock %}
